apiVersion: apps/v1
kind: Deployment
metadata:
  labels: {{- include "common.labels.standard" . | nindent 4 }}
    application-crd-id: kubeflow-pipelines
    component: metadata-envoy
  name: {{ printf "%s-metadata-envoy" (include "common.names.fullname" .) }}
  namespace: {{- include "common.names.namespace" . | quote }}
spec:
  replicas: 1
  selector:
    matchLabels: {{- include "common.labels.matchLabels" . | nindent 6 }}
      application-crd-id: kubeflow-pipelines
      component: metadata-envoy
  template:
    metadata:
      annotations:
        sidecar.istio.io/inject: "false"
      labels: {{- include "common.labels.matchLabels" . | nindent 8 }}
        application-crd-id: kubeflow-pipelines
        component: metadata-envoy
    spec:
      containers:
        - image: {{ include "common.images.image" (dict "imageRoot" .Values.metadata-envoy.image "global" .Values.global) }}
          imagePullPolicy: {{ .Values.metadata-envoy.image.pullPolicy | quote }}
          name: container
          ports:
            - containerPort: 9090
              name: md-envoy
            - containerPort: 9901
              name: envoy-admin
